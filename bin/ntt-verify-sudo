#!/bin/bash
# Wrapper for ntt-verify.py that properly preserves environment under sudo

# Source config from actual user's home (not root's ~)
if [[ -n "$SUDO_USER" ]]; then
  USER_HOME=$(eval echo ~$SUDO_USER)
  CONFIG_FILE="$USER_HOME/.config/ntt/ntt.env"
else
  CONFIG_FILE=~/.config/ntt/ntt.env
fi

if [[ -f "$CONFIG_FILE" ]]; then
  source "$CONFIG_FILE"
fi

# Run ntt-verify with environment variables passed explicitly
sudo \
  NTT_IGNORE_PATTERNS="$NTT_IGNORE_PATTERNS" \
  NTT_DB_URL="$NTT_DB_URL" \
  NTT_BY_HASH_ROOT="$NTT_BY_HASH_ROOT" \
  NTT_ARCHIVED_ROOT="$NTT_ARCHIVED_ROOT" \
  NTT_LOG_JSON="$NTT_LOG_JSON" \
  "$(dirname "$0")/ntt-verify.py" "$@"
